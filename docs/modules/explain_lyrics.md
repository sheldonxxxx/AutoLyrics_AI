# Explain Lyrics Module

## Overview

The `explain_lyrics.py` module provides functionality to analyze and explain song lyrics in a target language. It extracts lyrics from LRC format (removing timestamps), sends them to an LLM for detailed explanation, and returns a comprehensive analysis of the lyrics' meaning, cultural context, and artistic elements.

## Purpose

This module serves as an enhancement tool that goes beyond simple translation to provide deeper understanding of song lyrics. It helps users appreciate the cultural references, metaphors, and emotional content of songs by providing detailed explanations in their preferred language.

## Key Features

- **Lyrics Extraction**: Removes timestamps and metadata from LRC files to extract only the lyrics content
- **LLM Analysis**: Sends lyrics to an LLM for comprehensive explanation and analysis
- **Multi-language Support**: Supports explanation in any language supported by the LLM
- **Cultural Context**: Provides cultural and historical context for lyrics
- **Literary Analysis**: Identifies metaphors, similes, and other literary devices
- **Flexible Configuration**: Uses the same API configuration as other pipeline modules

## Technical Implementation

### Core Functions

#### `extract_lyrics_only(lrc_content)`
- Extracts only lyrics content from LRC files, removing timestamps and metadata
- Uses regular expressions to identify and filter out timestamp and metadata lines
- Returns clean lyrics text without timing information

#### `explain_lyrics_content(lrc_content, target_language)`
- Extracts lyrics from LRC content and sends to LLM for explanation
- Uses a specialized prompt template for lyrics analysis
- Handles API communication and error management
- Returns detailed explanation in the target language

#### `main(input_path, output_path, target_language, ...)`
- Main entry point for command-line usage
- Handles file I/O, logging, and error reporting
- Coordinates the explanation process

### Dependencies

- `pydantic-ai`: For structured LLM interactions
- `logging_config`: For consistent logging across the pipeline
- `utils`: For file operations and configuration management
- `dotenv`: For environment variable loading

### Prompt Template

The module uses a specialized prompt template (`prompt/lrc_explanation_prompt.txt`) that instructs the LLM to:

1. Analyze the lyrics' overall theme and message
2. Identify cultural or historical references
3. Explain metaphors, similes, and literary devices
4. Describe the emotional content and mood
5. Provide context for idioms and language-specific elements

## Usage Examples

### Command Line Usage

```bash
# Basic usage - explain lyrics in Traditional Chinese
python explain_lyrics.py input_song.lrc

# Specify output file and target language
python explain_lyrics.py input_song.lrc -o explanation.txt -l "English"

# With Logfire integration
python explain_lyrics.py input_song.lrc --logfire
```

### Programmatic Usage

```python
from explain_lyrics import explain_lyrics_content

# Read LRC content
with open('song.lrc', 'r', encoding='utf-8') as f:
    lrc_content = f.read()

# Get explanation in Traditional Chinese
explanation = explain_lyrics_content(lrc_content, "Traditional Chinese")

# Save the explanation
with open('explanation.txt', 'w', encoding='utf-8') as f:
    f.write(explanation)
```

## Configuration

The module uses the same environment variables as other pipeline modules:

- `OPENAI_API_KEY`: API key for the LLM service
- `OPENAI_BASE_URL`: Base URL for the LLM API
- `OPENAI_MODEL`: Model name to use for explanations

## Integration with Pipeline

This module can be used as an optional post-processing step after the main pipeline completes. It works with any LRC file, whether generated by the pipeline or provided independently.

## Error Handling

- Validates input file existence
- Handles API communication errors
- Manages LLM response parsing
- Provides detailed logging for debugging

## Output Format

The explanation is returned in a structured format with:

- Overall theme and message analysis
- Cultural and historical context
- Literary device identification
- Emotional content description
- Context for idioms and references